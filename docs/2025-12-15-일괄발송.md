# ğŸ“§ êµì‚¬ ëŒ€ì‹œë³´ë“œ ì¼ê´„ë°œì†¡ ê¸°ëŠ¥ ì´í•´í•˜ê¸°

**ì‘ì„±ì¼**: 2025ë…„ 12ì›” 15ì¼  
**ëŒ€ìƒ**: ì¤‘í•™ìƒë„ ë”°ë¼í•  ìˆ˜ ìˆëŠ” ìˆ˜ì¤€  
**ëª©í‘œ**: ê·¸ë£¹ íƒ­, ì¼ê´„ ë°œì†¡, ë°œì†¡ ì´ë ¥ ì»´í¬ë„ŒíŠ¸ ì´í•´í•˜ê¸°

---

## ğŸ“š ëª©ì°¨

1. [ì „ì²´ êµ¬ì¡° ì´í•´í•˜ê¸°](#1-ì „ì²´-êµ¬ì¡°-ì´í•´í•˜ê¸°)
2. [GroupTabs ì»´í¬ë„ŒíŠ¸](#2-grouptabs-ì»´í¬ë„ŒíŠ¸)
3. [BulkEmailSender ì»´í¬ë„ŒíŠ¸](#3-bulkemailsender-ì»´í¬ë„ŒíŠ¸)
4. [EmailHistory ì»´í¬ë„ŒíŠ¸](#4-emailhistory-ì»´í¬ë„ŒíŠ¸)
5. [ì‹¤ì‹œê°„ ë™ê¸°í™” ì ìš©](#5-ì‹¤ì‹œê°„-ë™ê¸°í™”-ì ìš©)
6. [ì—°ìŠµ ë¬¸ì œ](#6-ì—°ìŠµ-ë¬¸ì œ)

---

## 1. ì „ì²´ êµ¬ì¡° ì´í•´í•˜ê¸°

### ğŸ—ï¸ ì»´í¬ë„ŒíŠ¸ ê´€ê³„ë„

```
êµì‚¬ ëŒ€ì‹œë³´ë“œ (TeacherDashboard)
â”œâ”€â”€ ìƒì  íƒ­ (MeritForm)
â”œâ”€â”€ ë²Œì  íƒ­ (DemeritForm)
â”œâ”€â”€ ì´ë‹¬ì˜ í•™ìƒ íƒ­ (MonthlyForm)
â”œâ”€â”€ ê·¸ë£¹ ê´€ë¦¬ íƒ­ â­
â”‚   â””â”€â”€ GroupTabs
â”‚       â”œâ”€â”€ í•™ìƒ ì„ íƒ íƒ­ â†’ StudentGroupManager
â”‚       â””â”€â”€ êµì‚¬ ì„ íƒ íƒ­ â†’ TeacherGroupManager
â”œâ”€â”€ ì¼ê´„ ë°œì†¡ íƒ­ â­
â”‚   â””â”€â”€ BulkEmailSender
â””â”€â”€ ë°œì†¡ ì´ë ¥ íƒ­ â­
    â””â”€â”€ EmailHistory
```

### ğŸ”— ë°ì´í„° íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Supabase ë°ì´í„°ë² ì´ìŠ¤                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  student_groups    teacher_groups    email_templates    email_history
â”‚       â”‚                  â”‚                 â”‚                 â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                              â”‚
â”‚                              â–¼
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚                    í”„ë¡ íŠ¸ì—”ë“œ ì»´í¬ë„ŒíŠ¸                        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”‚                                                             â”‚
â”‚  â”‚  GroupTabs â”€â”€â”€â”€â”€â”€â–¶ StudentGroupManager                      â”‚
â”‚  â”‚         â”‚                 â”‚                                 â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â–¶ TeacherGroupManager                        â”‚
â”‚  â”‚                          â”‚                                  â”‚
â”‚  â”‚  BulkEmailSender â—€â”€â”€â”€â”€â”€â”€â”€â”˜ (ê·¸ë£¹ ë°ì´í„° ê³µìœ )                 â”‚
â”‚  â”‚         â”‚                                                   â”‚
â”‚  â”‚         â”‚ ë°œì†¡ â”€â”€â”€â”€â”€â–¶ Edge Function â”€â”€â”€â”€â”€â–¶ email_history    â”‚
â”‚  â”‚         â–¼                                                   â”‚
â”‚  â”‚  EmailHistory â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì´ë ¥ ì¡°íšŒ         â”‚
â”‚  â”‚                                                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. GroupTabs ì»´í¬ë„ŒíŠ¸

### ğŸ“ íŒŒì¼ ìœ„ì¹˜
`src/components/teacher/GroupTabs.tsx`

### ğŸ¯ ì—­í• 
í•™ìƒ ê·¸ë£¹ê³¼ êµì‚¬ ê·¸ë£¹ì„ íƒ­ìœ¼ë¡œ ì „í™˜í•˜ëŠ” ì»´í¬ë„ŒíŠ¸

### ğŸ’» ì „ì²´ ì½”ë“œ

```typescript
import { useState } from "react";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { GraduationCap, Users } from "lucide-react";
import StudentGroupManager from "./StudentGroupManager";
import TeacherGroupManager from "./TeacherGroupManager";

const GroupTabs = () => {
  // í˜„ì¬ ì„ íƒëœ íƒ­ ìƒíƒœ (ê¸°ë³¸ê°’: "students")
  const [activeTab, setActiveTab] = useState("students");

  return (
    <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">
      {/* íƒ­ ë²„íŠ¼ ëª©ë¡ */}
      <TabsList className="grid w-full grid-cols-2 mb-4">
        <TabsTrigger 
          value="students"
          className="data-[state=active]:bg-primary data-[state=active]:text-primary-foreground"
        >
          <GraduationCap className="w-4 h-4 mr-2" />
          í•™ìƒ ì„ íƒ
        </TabsTrigger>
        <TabsTrigger 
          value="teachers"
          className="data-[state=active]:bg-primary data-[state=active]:text-primary-foreground"
        >
          <Users className="w-4 h-4 mr-2" />
          êµì‚¬ ì„ íƒ
        </TabsTrigger>
      </TabsList>

      {/* íƒ­ ë‚´ìš© */}
      <TabsContent value="students" className="mt-0">
        <StudentGroupManager />
      </TabsContent>

      <TabsContent value="teachers" className="mt-0">
        <TeacherGroupManager />
      </TabsContent>
    </Tabs>
  );
};

export default GroupTabs;
```

### ğŸ“ ì½”ë“œ ì„¤ëª…

| ì½”ë“œ | ì„¤ëª… |
|------|------|
| `useState("students")` | ê¸°ë³¸ìœ¼ë¡œ "students" íƒ­ ì„ íƒ |
| `Tabs` | shadcn/uiì˜ íƒ­ ì»´í¬ë„ŒíŠ¸ |
| `TabsList` | íƒ­ ë²„íŠ¼ë“¤ì˜ ì»¨í…Œì´ë„ˆ |
| `TabsTrigger` | ê°ê°ì˜ íƒ­ ë²„íŠ¼ |
| `TabsContent` | íƒ­ ì„ íƒ ì‹œ ë³´ì—¬ì¤„ ë‚´ìš© |
| `value={activeTab}` | í˜„ì¬ í™œì„± íƒ­ ì—°ê²° |
| `onValueChange={setActiveTab}` | íƒ­ í´ë¦­ ì‹œ ìƒíƒœ ë³€ê²½ |

### ğŸ–¼ï¸ UI ë™ì‘ íë¦„

```
ì‚¬ìš©ìê°€ "êµì‚¬ ì„ íƒ" íƒ­ í´ë¦­
        â”‚
        â–¼
onValueChange ì‹¤í–‰
        â”‚
        â–¼
setActiveTab("teachers")
        â”‚
        â–¼
activeTab ìƒíƒœê°€ "teachers"ë¡œ ë³€ê²½
        â”‚
        â–¼
TabsContent value="teachers" ê°€ í™”ë©´ì— í‘œì‹œ
        â”‚
        â–¼
TeacherGroupManager ì»´í¬ë„ŒíŠ¸ ë Œë”ë§
```

---

## 3. BulkEmailSender ì»´í¬ë„ŒíŠ¸

### ğŸ“ íŒŒì¼ ìœ„ì¹˜
`src/components/teacher/BulkEmailSender.tsx`

### ğŸ¯ ì—­í• 
ì„ íƒí•œ ê·¸ë£¹ì—ê²Œ ì´ë©”ì¼ì„ ì¼ê´„ ë°œì†¡í•˜ëŠ” ì»´í¬ë„ŒíŠ¸

### ğŸ’» í•µì‹¬ ì½”ë“œ ë¶„ì„

#### 3-1. ì¸í„°í˜ì´ìŠ¤ ì •ì˜

```typescript
// í•™ìƒ ê·¸ë£¹ íƒ€ì…
interface StudentGroup {
  id: string;
  group_name: string;
  student_ids: string[];  // í•™ìƒ ID ë°°ì—´
}

// êµì‚¬ ê·¸ë£¹ íƒ€ì…
interface TeacherGroup {
  id: string;
  group_name: string;
  teacher_ids: string[];  // êµì‚¬ ID ë°°ì—´
}

// ì´ë©”ì¼ í…œí”Œë¦¿ íƒ€ì…
interface EmailTemplate {
  id: string;
  title: string;
  subject: string;
  body: string;
}

// í•™ìƒ ì •ë³´ íƒ€ì…
interface Student {
  student_id: string;
  name: string;
  gmail: string;
}

// êµì‚¬ ì •ë³´ íƒ€ì…
interface Teacher {
  id: string;
  name: string;
  teacher_email: string;
}
```

#### 3-2. ìƒíƒœ ê´€ë¦¬

```typescript
const BulkEmailSender = ({ isActive = false }: BulkEmailSenderProps) => {
  // ìˆ˜ì‹ ì ìœ í˜• (í•™ìƒ or êµì‚¬)
  const [recipientType, setRecipientType] = useState<"student" | "teacher">("student");
  
  // ê·¸ë£¹ ëª©ë¡
  const [studentGroups, setStudentGroups] = useState<StudentGroup[]>([]);
  const [teacherGroups, setTeacherGroups] = useState<TeacherGroup[]>([]);
  
  // í…œí”Œë¦¿ ëª©ë¡
  const [templates, setTemplates] = useState<EmailTemplate[]>([]);
  
  // ì„ íƒëœ í•­ëª©ë“¤
  const [selectedGroup, setSelectedGroup] = useState<string>("");
  const [selectedTemplate, setSelectedTemplate] = useState<string>("");
  
  // ì´ë©”ì¼ ë‚´ìš©
  const [subject, setSubject] = useState("");
  const [body, setBody] = useState("");
  
  // ë°œì†¡ ìƒíƒœ
  const [isSending, setIsSending] = useState(false);
  
  // ì²¨ë¶€íŒŒì¼
  const [attachments, setAttachments] = useState<File[]>([]);
  
  // ì´ë©”ì¼ ì—†ëŠ” ìˆ˜ì‹ ì ê²½ê³ 
  const [recipientsWithoutEmail, setRecipientsWithoutEmail] = useState<string[]>([]);
  const [validEmailCount, setValidEmailCount] = useState<number>(0);

  // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì
  const authUser = localStorage.getItem("auth_user");
  const user = authUser ? JSON.parse(authUser) : null;
```

**ìƒíƒœ ê´€ê³„ë„:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BulkEmailSender ìƒíƒœ                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  recipientType â”€â”€â”€â”€â”€â”¬â”€â”€â”€â–¶ "student" ë˜ëŠ” "teacher"      â”‚
â”‚                     â”‚                                   â”‚
â”‚                     â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ recipientType === "student"                     â”‚   â”‚
â”‚  â”‚   â†’ studentGroups í‘œì‹œ                          â”‚   â”‚
â”‚  â”‚   â†’ í•™ìƒìš© í…œí”Œë¦¿ë§Œ í‘œì‹œ                         â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ recipientType === "teacher"                     â”‚   â”‚
â”‚  â”‚   â†’ teacherGroups í‘œì‹œ                          â”‚   â”‚
â”‚  â”‚   â†’ êµì‚¬ìš© í…œí”Œë¦¿ë§Œ í‘œì‹œ                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â”‚  selectedGroup â”€â”€â”€â”€â”€â–¶ ì„ íƒëœ ê·¸ë£¹ ID                    â”‚
â”‚         â”‚                                               â”‚
â”‚         â–¼                                               â”‚
â”‚  recipientsWithoutEmail â”€â–¶ ì´ë©”ì¼ ì—†ëŠ” ì‚¬ëŒ ëª©ë¡         â”‚
â”‚  validEmailCount â”€â”€â”€â”€â”€â”€â”€â”€â–¶ ë°œì†¡ ê°€ëŠ¥í•œ ì¸ì› ìˆ˜           â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3-3. ì‹¤ì‹œê°„ ë™ê¸°í™” ì„¤ì •

```typescript
// êµ¬ë…í•  í…Œì´ë¸” ì„¤ì •
const groupTables: TableSubscription[] = user ? [
  {
    channelName: "bulk-email-student-groups",  // ê³ ìœ í•œ ì±„ë„ ì´ë¦„
    table: "student_groups",                   // êµ¬ë…í•  í…Œì´ë¸”
    filter: `admin_id=eq.${user.id}`,          // ë‚´ ê·¸ë£¹ë§Œ ê°ì§€
    labels: {
      insert: "ìƒˆ í•™ìƒ ê·¸ë£¹ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤",
      update: "í•™ìƒ ê·¸ë£¹ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤",
      delete: "í•™ìƒ ê·¸ë£¹ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤",
    },
  },
  {
    channelName: "bulk-email-teacher-groups",
    table: "teacher_groups",
    filter: `admin_id=eq.${user.id}`,
    labels: {
      insert: "ìƒˆ êµì‚¬ ê·¸ë£¹ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤",
      update: "êµì‚¬ ê·¸ë£¹ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤",
      delete: "êµì‚¬ ê·¸ë£¹ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤",
    },
  },
  {
    channelName: "bulk-email-templates",
    table: "email_templates",
    labels: {
      insert: "ìƒˆ í…œí”Œë¦¿ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤",
      update: "í…œí”Œë¦¿ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤",
      delete: "í…œí”Œë¦¿ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤",
    },
  },
] : [];

// ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜
const handleRefresh = useCallback(async () => {
  await Promise.all([
    loadStudentGroups(),
    loadTeacherGroups(),
    loadTemplates(),
  ]);
}, []);

// ì»¤ìŠ¤í…€ í›… ì‚¬ìš©
useRealtimeSync({
  tables: groupTables,
  onRefresh: handleRefresh,
  enabled: !!user,
});
```

**ì‹¤ì‹œê°„ ë™ê¸°í™” íë¦„:**

```
ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ì—ì„œ ê·¸ë£¹ ìˆ˜ì •
        â”‚
        â–¼
Supabaseì—ì„œ ë³€ê²½ ê°ì§€
        â”‚
        â–¼
bulk-email-student-groups ì±„ë„ë¡œ ì•Œë¦¼
        â”‚
        â–¼
handleRefresh() ì‹¤í–‰
        â”‚
        â–¼
loadStudentGroups() + loadTeacherGroups() + loadTemplates()
        â”‚
        â–¼
í™”ë©´ ìë™ ê°±ì‹  + í† ìŠ¤íŠ¸ ì•Œë¦¼
```

#### 3-4. ì‚­ì œëœ ê·¸ë£¹ ìë™ ê°ì§€

```typescript
// ì„ íƒëœ ê·¸ë£¹ì´ ëª©ë¡ì—ì„œ ì‚¬ë¼ì§€ë©´ ì„ íƒ í•´ì œ
useEffect(() => {
  if (selectedGroup) {
    if (recipientType === "student") {
      const exists = studentGroups.some(g => g.id === selectedGroup);
      if (!exists) setSelectedGroup("");  // ì„ íƒ ì´ˆê¸°í™”
    } else {
      const exists = teacherGroups.some(g => g.id === selectedGroup);
      if (!exists) setSelectedGroup("");
    }
  }
}, [studentGroups, teacherGroups, recipientType, selectedGroup]);
```

**ë™ì‘ ì˜ˆì‹œ:**

```
í˜„ì¬ ìƒíƒœ: selectedGroup = "group-123" (Aê·¸ë£¹)
        â”‚
        â–¼
ë‹¤ë¥¸ íƒ­ì—ì„œ Aê·¸ë£¹ ì‚­ì œë¨
        â”‚
        â–¼
ì‹¤ì‹œê°„ ë™ê¸°í™”ë¡œ studentGroups ì—…ë°ì´íŠ¸
        â”‚
        â–¼
useEffect ì‹¤í–‰
        â”‚
        â–¼
studentGroups.some(g => g.id === "group-123") â†’ false
        â”‚
        â–¼
setSelectedGroup("") â†’ ì„ íƒ í•´ì œë¨
```

#### 3-5. ìˆ˜ì‹ ì ìœ í˜•ë³„ í…œí”Œë¦¿ í•„í„°ë§

```typescript
<SelectContent>
  <SelectItem value="__none__">ì§ì ‘ ì‘ì„±</SelectItem>
  {recipientType === "student" ? (
    <>
      {/* í•™ìƒìš© í…œí”Œë¦¿ë§Œ í‘œì‹œ */}
      {templates.filter(t => 
        t.title === "ê°€ì •í†µì‹ ë¬¸" || t.title === "ì‚¬ì œë™í–‰ ë””ì§€í„¸ ì±Œë¦°ì§€"
      ).map(template => (
        <SelectItem key={template.id} value={template.id}>
          {template.title}
        </SelectItem>
      ))}
    </>
  ) : (
    <>
      {/* êµì‚¬ìš© í…œí”Œë¦¿ë§Œ í‘œì‹œ */}
      {templates.filter(t => 
        t.title === "êµì‚¬ ì¹œëª©íšŒ" || t.title === "ì „ê³µì‹¬í™”ë™ì•„ë¦¬ ë‹´ì„"
      ).map(template => (
        <SelectItem key={template.id} value={template.id}>
          {template.title}
        </SelectItem>
      ))}
    </>
  )}
</SelectContent>
```

#### 3-6. ì´ë©”ì¼ ë°œì†¡ í•¨ìˆ˜

```typescript
const handleSend = async () => {
  // ìœ íš¨ì„± ê²€ì‚¬
  if (!selectedGroup) {
    toast.error("ê·¸ë£¹ì„ ì„ íƒí•˜ì„¸ìš”");
    return;
  }

  if (!subject.trim() || !body.trim()) {
    toast.error("ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”");
    return;
  }

  try {
    setIsSending(true);  // ë°œì†¡ ì¤‘ ìƒíƒœë¡œ ë³€ê²½
    
    if (recipientType === "student") {
      // í•™ìƒ ì¼ê´„ ë°œì†¡
      const group = studentGroups.find(g => g.id === selectedGroup);
      
      // í•™ìƒ ì •ë³´ ì¡°íšŒ
      const { data: studentsData } = await supabase.rpc(
        "teacher_get_students_by_ids",
        {
          teacher_id_input: user.id,
          student_ids_input: group.student_ids,
        }
      );

      // ì´ë©”ì¼ì´ ìˆëŠ” í•™ìƒë§Œ í•„í„°ë§
      const validStudents = studentsData.filter(
        (s: Student) => s.gmail && s.gmail.includes("@")
      );

      // Edge Function í˜¸ì¶œ
      const { data, error } = await supabase.functions.invoke("send-bulk-email", {
        body: {
          adminId: user.id,
          subject: subject,
          body: body,
          students: validStudents.map((s: Student) => ({
            studentId: s.student_id,
            name: s.name,
            email: s.gmail,
          })),
        },
      });

      toast.success(`í•™ìƒ ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ\nì„±ê³µ: ${data.totalSent}ê±´`);
    } else {
      // êµì‚¬ ì¼ê´„ ë°œì†¡ (ë¹„ìŠ·í•œ ë¡œì§)
      // ...
    }
    
    // í¼ ì´ˆê¸°í™”
    setSelectedTemplate("");
    setSubject("");
    setBody("");
    setAttachments([]);
  } catch (error: any) {
    toast.error("ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨: " + error.message);
  } finally {
    setIsSending(false);  // ë°œì†¡ ì™„ë£Œ
  }
};
```

**ë°œì†¡ íë¦„:**

```
handleSend() ì‹¤í–‰
        â”‚
        â”œâ”€â”€ 1. ìœ íš¨ì„± ê²€ì‚¬ (ê·¸ë£¹ ì„ íƒ? ì œëª©/ë‚´ìš© ì…ë ¥?)
        â”‚
        â”œâ”€â”€ 2. setIsSending(true) - ë²„íŠ¼ ë¹„í™œì„±í™”
        â”‚
        â”œâ”€â”€ 3. ê·¸ë£¹ì—ì„œ ìˆ˜ì‹ ì ëª©ë¡ ì¡°íšŒ
        â”‚
        â”œâ”€â”€ 4. ì´ë©”ì¼ ìˆëŠ” ìˆ˜ì‹ ìë§Œ í•„í„°ë§
        â”‚
        â”œâ”€â”€ 5. Edge Function í˜¸ì¶œ (send-bulk-email)
        â”‚           â”‚
        â”‚           â–¼
        â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   â”‚ Supabase Edge Function  â”‚
        â”‚   â”‚ - Resend API í˜¸ì¶œ       â”‚
        â”‚   â”‚ - email_history ì €ì¥    â”‚
        â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”œâ”€â”€ 6. ê²°ê³¼ í† ìŠ¤íŠ¸ í‘œì‹œ
        â”‚
        â”œâ”€â”€ 7. í¼ ì´ˆê¸°í™”
        â”‚
        â””â”€â”€ 8. setIsSending(false) - ë²„íŠ¼ í™œì„±í™”
```

---

## 4. EmailHistory ì»´í¬ë„ŒíŠ¸

### ğŸ“ íŒŒì¼ ìœ„ì¹˜
`src/components/teacher/EmailHistory.tsx`

### ğŸ¯ ì—­í• 
ë°œì†¡í•œ ì´ë©”ì¼ ì´ë ¥ì„ ì¡°íšŒí•˜ê³  ê´€ë¦¬í•˜ëŠ” ì»´í¬ë„ŒíŠ¸

### ğŸ’» í•µì‹¬ ì½”ë“œ ë¶„ì„

#### 4-1. ì¸í„°í˜ì´ìŠ¤ì™€ ìƒíƒœ

```typescript
interface EmailRecord {
  id: string;
  recipient_name: string;       // ìˆ˜ì‹ ì ì´ë¦„
  recipient_email: string;      // ìˆ˜ì‹ ì ì´ë©”ì¼
  recipient_student_id: string | null;  // í•™ìƒ ID (êµì‚¬ë©´ null)
  subject: string;              // ì œëª©
  body: string;                 // ë³¸ë¬¸
  sent_at: string;              // ë°œì†¡ ì‹œê°„
}

const PAGE_SIZE = 5;  // í•œ í˜ì´ì§€ë‹¹ í‘œì‹œí•  ì´ë©”ì¼ ìˆ˜

const EmailHistory = () => {
  const [emails, setEmails] = useState<EmailRecord[]>([]);
  const [loading, setLoading] = useState(true);
  
  // í˜ì´ì§€ë„¤ì´ì…˜ (ë”ë³´ê¸° ë°©ì‹)
  const [studentDisplayCount, setStudentDisplayCount] = useState(PAGE_SIZE);
  const [teacherDisplayCount, setTeacherDisplayCount] = useState(PAGE_SIZE);
  
  // í˜„ì¬ íƒ­
  const [activeTab, setActiveTab] = useState("student");
  
  // ìƒì„¸ë³´ê¸° ëª¨ë‹¬
  const [selectedEmail, setSelectedEmail] = useState<EmailRecord | null>(null);
  const [detailDialogOpen, setDetailDialogOpen] = useState(false);
  
  // ë‚ ì§œ í•„í„°
  const [startDate, setStartDate] = useState<Date | undefined>(undefined);
  const [endDate, setEndDate] = useState<Date | undefined>(undefined);
```

#### 4-2. ë°ì´í„° ë¡œë”©

```typescript
const loadEmails = useCallback(async () => {
  try {
    setLoading(true);
    const authUser = localStorage.getItem("auth_user");
    if (!authUser) return;

    const user = JSON.parse(authUser);

    // RPC í•¨ìˆ˜ë¡œ ì´ë©”ì¼ ì´ë ¥ ì¡°íšŒ
    const { data, error } = await supabase.rpc("teacher_get_email_history", {
      teacher_id_input: user.id
    });

    if (error) throw error;
    
    // ë°ì´í„° ë³€í™˜ ë° ì €ì¥
    const emailData: EmailRecord[] = (data || []).map((item: any) => ({
      id: item.id,
      recipient_name: item.recipient_name,
      recipient_email: item.recipient_email,
      recipient_student_id: item.recipient_student_id ?? null,
      subject: item.subject,
      body: item.body,
      sent_at: item.sent_at
    }));
    
    setEmails(emailData);
  } catch (error: any) {
    toast.error("ì´ë©”ì¼ ì´ë ¥ ì¡°íšŒ ì‹¤íŒ¨: " + error.message);
  } finally {
    setLoading(false);
  }
}, []);
```

#### 4-3. ì‹¤ì‹œê°„ ë™ê¸°í™”

```typescript
// ì´ë©”ì¼ ë°œì†¡ ì‹œ ìë™ ê°±ì‹ 
useRealtimeSync({
  tables: userId ? [
    {
      table: "email_history",
      channelName: `teacher-email-history-${userId}`,  // ì‚¬ìš©ìë³„ ê³ ìœ  ì±„ë„
      filter: `sender_id=eq.${userId}`,                // ë‚´ê°€ ë³´ë‚¸ ê²ƒë§Œ
      labels: {
        insert: "ğŸ”„ ìƒˆ ì´ë©”ì¼ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤"
      }
    }
  ] : [],
  onRefresh: loadEmails,
  enabled: !!userId,
  dependencies: [userId]
});
```

#### 4-4. í•™ìƒ/êµì‚¬ ì´ë ¥ ë¶„ë¦¬

```typescript
// ë‚ ì§œ í•„í„°ë§ ì ìš©
const filteredEmails = useMemo(() => {
  if (!startDate && !endDate) return emails;
  
  return emails.filter(email => {
    const emailDate = new Date(email.sent_at);
    
    if (startDate && endDate) {
      return isWithinInterval(emailDate, {
        start: startOfDay(startDate),
        end: endOfDay(endDate)
      });
    }
    
    if (startDate) return emailDate >= startOfDay(startDate);
    if (endDate) return emailDate <= endOfDay(endDate);
    
    return true;
  });
}, [emails, startDate, endDate]);

// í•™ìƒ/êµì‚¬ êµ¬ë¶„ (recipient_student_idë¡œ íŒë‹¨)
const studentEmails = filteredEmails.filter(e => e.recipient_student_id !== null);
const teacherEmails = filteredEmails.filter(e => e.recipient_student_id === null);
```

**êµ¬ë¶„ ê¸°ì¤€:**

```
recipient_student_id ê°’ì— ë”°ë¥¸ ë¶„ë¥˜
        â”‚
        â”œâ”€â”€ "STU001" (ê°’ ìˆìŒ) â†’ í•™ìƒì—ê²Œ ë³´ë‚¸ ì´ë©”ì¼
        â”‚
        â””â”€â”€ null (ê°’ ì—†ìŒ) â†’ êµì‚¬ì—ê²Œ ë³´ë‚¸ ì´ë©”ì¼
```

#### 4-5. CSV ë‚´ë³´ë‚´ê¸°

```typescript
const handleExportCSV = (exportType: "student" | "teacher" | "all") => {
  let emailsToExport: EmailRecord[];
  let typeStr: string;
  
  // ë‚´ë³´ë‚¼ ë°ì´í„° ì„ íƒ
  switch (exportType) {
    case "student":
      emailsToExport = studentEmails;
      typeStr = "í•™ìƒ";
      break;
    case "teacher":
      emailsToExport = teacherEmails;
      typeStr = "êµì‚¬";
      break;
    case "all":
      emailsToExport = filteredEmails;
      typeStr = "ì „ì²´";
      break;
  }
  
  if (emailsToExport.length === 0) {
    toast.error("ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤");
    return;
  }

  // CSV í—¤ë” (ì „ì²´ì¼ ê²½ìš° ìˆ˜ì‹ ì ìœ í˜• ì¶”ê°€)
  const headers = exportType === "all" 
    ? ["ìˆ˜ì‹ ììœ í˜•", "ë°œì†¡ì¼ì‹œ", "ìˆ˜ì‹ ì", "ì´ë©”ì¼", "ì œëª©", "ë³¸ë¬¸"]
    : ["ë°œì†¡ì¼ì‹œ", "ìˆ˜ì‹ ì", "ì´ë©”ì¼", "ì œëª©", "ë³¸ë¬¸"];
  
  // CSV ë°ì´í„° ìƒì„±
  const csvData = emailsToExport.map(email => {
    // HTML íƒœê·¸ ì œê±°, ìŒë”°ì˜´í‘œ ì´ìŠ¤ì¼€ì´í”„
    const cleanBody = email.body.replace(/<[^>]*>/g, "").replace(/"/g, '""');
    
    const baseData = [
      formatDate(email.sent_at),
      email.recipient_name,
      email.recipient_email,
      email.subject,
      cleanBody
    ];
    
    if (exportType === "all") {
      return [email.recipient_student_id ? "í•™ìƒ" : "êµì‚¬", ...baseData];
    }
    return baseData;
  });

  // CSV ë¬¸ìì—´ ìƒì„±
  const csvContent = [
    headers.join(","),
    ...csvData.map(row => row.map(cell => `"${cell}"`).join(","))
  ].join("\n");

  // BOM ì¶”ê°€ (í•œê¸€ ê¹¨ì§ ë°©ì§€)
  const bom = "\uFEFF";
  const blob = new Blob([bom + csvContent], { type: "text/csv;charset=utf-8;" });
  
  // ë‹¤ìš´ë¡œë“œ
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = `ë°œì†¡ì´ë ¥_${typeStr}_${format(new Date(), "yyyyMMdd_HHmm")}.csv`;
  link.click();
  
  toast.success(`${emailsToExport.length}ê±´ì˜ ì´ë ¥ì„ ë‚´ë³´ëƒˆìŠµë‹ˆë‹¤`);
};
```

**CSV ìƒì„± ê³¼ì •:**

```
handleExportCSV("student") í˜¸ì¶œ
        â”‚
        â–¼
studentEmails ë°ì´í„° ì„ íƒ
        â”‚
        â–¼
í—¤ë” ìƒì„±: ["ë°œì†¡ì¼ì‹œ", "ìˆ˜ì‹ ì", "ì´ë©”ì¼", "ì œëª©", "ë³¸ë¬¸"]
        â”‚
        â–¼
ê° ì´ë©”ì¼ì„ ë°°ì—´ë¡œ ë³€í™˜
        â”‚
        â–¼
CSV ë¬¸ìì—´ ìƒì„± (ì‰¼í‘œë¡œ êµ¬ë¶„)
        â”‚
        â–¼
BOM ì¶”ê°€ (í•œê¸€ ê¹¨ì§ ë°©ì§€)
        â”‚
        â–¼
Blob ìƒì„± â†’ URL ìƒì„± â†’ ë‹¤ìš´ë¡œë“œ ë§í¬ í´ë¦­
        â”‚
        â–¼
"ë°œì†¡ì´ë ¥_í•™ìƒ_20251215_1430.csv" íŒŒì¼ ë‹¤ìš´ë¡œë“œ
```

#### 4-6. ë”ë³´ê¸° ê¸°ëŠ¥

```typescript
const renderEmailTable = (
  emailList: EmailRecord[], 
  displayCount: number, 
  setDisplayCount: React.Dispatch<React.SetStateAction<number>>
) => {
  // ë¹ˆ ëª©ë¡ ì²˜ë¦¬
  if (emailList.length === 0) {
    return (
      <div className="text-center py-8 text-muted-foreground text-sm">
        {startDate || endDate 
          ? "í•´ë‹¹ ê¸°ê°„ì— ë°œì†¡í•œ ì´ë©”ì¼ì´ ì—†ìŠµë‹ˆë‹¤" 
          : "ë°œì†¡í•œ ì´ë©”ì¼ì´ ì—†ìŠµë‹ˆë‹¤"}
      </div>
    );
  }

  return (
    <div>
      <Table>
        <TableBody>
          {/* displayCountë§Œí¼ë§Œ í‘œì‹œ (slice ì‚¬ìš©) */}
          {emailList.slice(0, displayCount).map((email) => (
            <TableRow key={email.id} onClick={() => handleEmailClick(email)}>
              {/* ... í…Œì´ë¸” ë‚´ìš© ... */}
            </TableRow>
          ))}
        </TableBody>
      </Table>
      
      {/* ë” ë³¼ í•­ëª©ì´ ìˆìœ¼ë©´ ë”ë³´ê¸° ë²„íŠ¼ í‘œì‹œ */}
      {emailList.length > displayCount && (
        <Button
          variant="ghost"
          onClick={() => setDisplayCount((prev) => prev + PAGE_SIZE)}
        >
          ... ë”ë³´ê¸° ({emailList.length - displayCount}ê±´)
        </Button>
      )}
    </div>
  );
};
```

**ë”ë³´ê¸° ë™ì‘:**

```
ì´ˆê¸° ìƒíƒœ: displayCount = 5, ì „ì²´ ì´ë©”ì¼ = 12ê±´
        â”‚
        â–¼
í™”ë©´ì— 5ê±´ í‘œì‹œ
"... ë”ë³´ê¸° (7ê±´)" ë²„íŠ¼ í‘œì‹œ
        â”‚
        â–¼ ë²„íŠ¼ í´ë¦­
        â”‚
setDisplayCount(prev => prev + 5) â†’ displayCount = 10
        â”‚
        â–¼
í™”ë©´ì— 10ê±´ í‘œì‹œ
"... ë”ë³´ê¸° (2ê±´)" ë²„íŠ¼ í‘œì‹œ
        â”‚
        â–¼ ë²„íŠ¼ í´ë¦­
        â”‚
displayCount = 15 (ì „ì²´ 12ê±´ë³´ë‹¤ í¼)
        â”‚
        â–¼
í™”ë©´ì— 12ê±´ ëª¨ë‘ í‘œì‹œ
ë”ë³´ê¸° ë²„íŠ¼ ìˆ¨ê¹€ (ì¡°ê±´: emailList.length > displayCount ê°€ false)
```

---

## 5. ì‹¤ì‹œê°„ ë™ê¸°í™” ì ìš©

### ğŸ“Š ê° ì»´í¬ë„ŒíŠ¸ë³„ ì‹¤ì‹œê°„ ë™ê¸°í™” ë¹„êµ

| ì»´í¬ë„ŒíŠ¸ | êµ¬ë… í…Œì´ë¸” | í•„í„° | ìƒˆë¡œê³ ì¹¨ ëŒ€ìƒ |
|---------|------------|------|-------------|
| BulkEmailSender | student_groups, teacher_groups, email_templates | admin_id | ê·¸ë£¹ + í…œí”Œë¦¿ |
| EmailHistory | email_history | sender_id | ì´ë©”ì¼ ì´ë ¥ |

### ğŸ”„ ì»´í¬ë„ŒíŠ¸ ê°„ ì—°ë™ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BulkEmailSenderì—ì„œ ì´ë©”ì¼ ë°œì†¡                                 â”‚
â”‚         â”‚                                                       â”‚
â”‚         â–¼                                                       â”‚
â”‚  Edge Function í˜¸ì¶œ (send-bulk-email)                           â”‚
â”‚         â”‚                                                       â”‚
â”‚         â”œâ”€â”€â–¶ Resend APIë¡œ ì´ë©”ì¼ ë°œì†¡                            â”‚
â”‚         â”‚                                                       â”‚
â”‚         â””â”€â”€â–¶ email_history í…Œì´ë¸”ì— ê¸°ë¡ ì €ì¥                    â”‚
â”‚                    â”‚                                            â”‚
â”‚                    â–¼                                            â”‚
â”‚  Supabase Realtimeì´ INSERT ê°ì§€                                â”‚
â”‚                    â”‚                                            â”‚
â”‚                    â–¼                                            â”‚
â”‚  EmailHistoryì˜ useRealtimeSyncê°€ ì•Œë¦¼ ë°›ìŒ                      â”‚
â”‚                    â”‚                                            â”‚
â”‚                    â–¼                                            â”‚
â”‚  loadEmails() ìë™ í˜¸ì¶œ â†’ ëª©ë¡ ê°±ì‹                               â”‚
â”‚                    â”‚                                            â”‚
â”‚                    â–¼                                            â”‚
â”‚  "ğŸ”„ ìƒˆ ì´ë©”ì¼ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤" í† ìŠ¤íŠ¸ í‘œì‹œ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ’¡ ì±„ë„ ì´ë¦„ ê·œì¹™

```
ì»´í¬ë„ŒíŠ¸ ì´ë¦„ + í…Œì´ë¸” ì´ë¦„ + (í•„ìš”ì‹œ) ì‚¬ìš©ì ID

ì˜ˆì‹œ:
- "bulk-email-student-groups"     â† BulkEmailSender + student_groups
- "bulk-email-teacher-groups"     â† BulkEmailSender + teacher_groups  
- "bulk-email-templates"          â† BulkEmailSender + email_templates
- "teacher-email-history-abc123"  â† EmailHistory + email_history + userId
```

---

## 6. ì—°ìŠµ ë¬¸ì œ

### ğŸ§ª ë¬¸ì œ 1: ìƒíƒœ ì´í•´í•˜ê¸°

BulkEmailSenderì—ì„œ `recipientType`ì´ "teacher"ë¡œ ë°”ë€Œë©´ ì–´ë–¤ ì¼ì´ ì¼ì–´ë‚˜ë‚˜ìš”?

<details>
<summary>ì •ë‹µ ë³´ê¸°</summary>

```typescript
useEffect(() => {
  setSelectedGroup("");        // ì„ íƒëœ ê·¸ë£¹ ì´ˆê¸°í™”
  setSelectedTemplate("");     // ì„ íƒëœ í…œí”Œë¦¿ ì´ˆê¸°í™”
  setSubject("");              // ì œëª© ì´ˆê¸°í™”
  setBody("");                 // ë³¸ë¬¸ ì´ˆê¸°í™”
  setRecipientsWithoutEmail([]);  // ê²½ê³  ëª©ë¡ ì´ˆê¸°í™”
  setValidEmailCount(0);       // ìœ íš¨ ì´ë©”ì¼ ìˆ˜ ì´ˆê¸°í™”
}, [recipientType]);
```

**ë³€ê²½ë˜ëŠ” ê²ƒë“¤:**
1. ê·¸ë£¹ ì„ íƒ ì´ˆê¸°í™”
2. í…œí”Œë¦¿ ì„ íƒ ì´ˆê¸°í™”
3. ì œëª©/ë³¸ë¬¸ ì´ˆê¸°í™”
4. ì´ë©”ì¼ ì—†ëŠ” ìˆ˜ì‹ ì ê²½ê³  ì´ˆê¸°í™”
5. ê·¸ë£¹ ë“œë¡­ë‹¤ìš´ì— teacherGroups í‘œì‹œ
6. í…œí”Œë¦¿ ë“œë¡­ë‹¤ìš´ì— êµì‚¬ìš© í…œí”Œë¦¿ë§Œ í‘œì‹œ

</details>

---

### ğŸ§ª ë¬¸ì œ 2: í•„í„°ë§ ë¡œì§

ë‹¤ìŒ ì¤‘ `studentEmails`ì— í¬í•¨ë˜ëŠ” ì´ë©”ì¼ì€?

```typescript
const emails = [
  { id: "1", recipient_student_id: "STU001", recipient_name: "ê¹€ì² ìˆ˜" },
  { id: "2", recipient_student_id: null, recipient_name: "ë°•ì„ ìƒ" },
  { id: "3", recipient_student_id: "STU002", recipient_name: "ì´ì˜í¬" },
];

const studentEmails = emails.filter(e => e.recipient_student_id !== null);
```

<details>
<summary>ì •ë‹µ ë³´ê¸°</summary>

**ì •ë‹µ: idê°€ "1"ê³¼ "3"ì¸ ì´ë©”ì¼**

```typescript
studentEmails = [
  { id: "1", recipient_student_id: "STU001", recipient_name: "ê¹€ì² ìˆ˜" },
  { id: "3", recipient_student_id: "STU002", recipient_name: "ì´ì˜í¬" },
];
```

`recipient_student_id !== null` ì¡°ê±´ìœ¼ë¡œ í•„í„°ë§í•˜ë©´:
- "STU001" !== null â†’ true âœ…
- null !== null â†’ false âŒ
- "STU002" !== null â†’ true âœ…

</details>

---

### ğŸ§ª ë¬¸ì œ 3: ë”ë³´ê¸° êµ¬í˜„

10ê±´ì˜ ì´ë©”ì¼ì´ ìˆê³ , PAGE_SIZEê°€ 3ì¼ ë•Œ ë”ë³´ê¸° ë²„íŠ¼ì„ 3ë²ˆ í´ë¦­í•˜ë©´ displayCountëŠ” ì–¼ë§ˆê°€ ë˜ë‚˜ìš”?

<details>
<summary>ì •ë‹µ ë³´ê¸°</summary>

**ì •ë‹µ: 12**

```
ì´ˆê¸°: displayCount = 3
1ë²ˆ í´ë¦­: displayCount = 3 + 3 = 6
2ë²ˆ í´ë¦­: displayCount = 6 + 3 = 9
3ë²ˆ í´ë¦­: displayCount = 9 + 3 = 12
```

í•˜ì§€ë§Œ ì „ì²´ê°€ 10ê±´ì´ë¯€ë¡œ í™”ë©´ì—ëŠ” 10ê±´ë§Œ í‘œì‹œë©ë‹ˆë‹¤.
`slice(0, displayCount)`ê°€ `slice(0, 12)`ê°€ ë˜ì§€ë§Œ, ë°°ì—´ ê¸¸ì´ê°€ 10ì´ë¯€ë¡œ 10ê°œë§Œ ë°˜í™˜ë©ë‹ˆë‹¤.

</details>

---

### ğŸ§ª ë¬¸ì œ 4: ì‹¤ì‹œê°„ ë™ê¸°í™”

BulkEmailSenderì™€ StudentGroupManagerê°€ ë™ì‹œì— ì—´ë ¤ìˆì„ ë•Œ, StudentGroupManagerì—ì„œ ê·¸ë£¹ì„ ì‚­ì œí•˜ë©´ BulkEmailSenderì— ì–´ë–¤ ì¼ì´ ì¼ì–´ë‚˜ë‚˜ìš”?

<details>
<summary>ì •ë‹µ ë³´ê¸°</summary>

**ì¼ì–´ë‚˜ëŠ” ì¼:**

1. StudentGroupManagerì—ì„œ ê·¸ë£¹ ì‚­ì œ API í˜¸ì¶œ
2. Supabaseì—ì„œ student_groups í…Œì´ë¸”ì— DELETE ì´ë²¤íŠ¸ ë°œìƒ
3. BulkEmailSenderì˜ "bulk-email-student-groups" ì±„ë„ì´ ì´ë²¤íŠ¸ ê°ì§€
4. handleRefresh() í˜¸ì¶œ â†’ loadStudentGroups() ì‹¤í–‰
5. studentGroups ìƒíƒœ ì—…ë°ì´íŠ¸ (ì‚­ì œëœ ê·¸ë£¹ ì œì™¸)
6. "í•™ìƒ ê·¸ë£¹ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤" í† ìŠ¤íŠ¸ í‘œì‹œ
7. useEffectê°€ selectedGroup í™•ì¸ â†’ ì‚­ì œëœ ê·¸ë£¹ì´ë©´ ì„ íƒ í•´ì œ

```typescript
// ì´ useEffectê°€ ì‹¤í–‰ë¨
useEffect(() => {
  if (selectedGroup) {
    const exists = studentGroups.some(g => g.id === selectedGroup);
    if (!exists) setSelectedGroup("");  // ì„ íƒ í•´ì œ
  }
}, [studentGroups, ...]);
```

</details>

---

### ğŸ§ª ë¬¸ì œ 5: CSV ë‚´ë³´ë‚´ê¸°

CSVì—ì„œ í•œê¸€ì´ ê¹¨ì§€ì§€ ì•Šë„ë¡ í•˜ê¸° ìœ„í•´ ì¶”ê°€í•˜ëŠ” ê²ƒì€ ë¬´ì—‡ì¸ê°€ìš”?

<details>
<summary>ì •ë‹µ ë³´ê¸°</summary>

**ì •ë‹µ: BOM (Byte Order Mark)**

```typescript
const bom = "\uFEFF";  // UTF-8 BOM
const blob = new Blob([bom + csvContent], { type: "text/csv;charset=utf-8;" });
```

BOMì´ë€?
- íŒŒì¼ ì‹œì‘ ë¶€ë¶„ì— ì¶”ê°€ë˜ëŠ” íŠ¹ìˆ˜ ë¬¸ì
- í…ìŠ¤íŠ¸ íŒŒì¼ì˜ ì¸ì½”ë”©ì„ í‘œì‹œ
- `\uFEFF`ëŠ” UTF-8 BOM
- ì—‘ì…€ì—ì„œ CSVë¥¼ ì—´ ë•Œ í•œê¸€ì„ ì˜¬ë°”ë¥´ê²Œ ì¸ì‹í•˜ë„ë¡ ë„ì›€

BOM ì—†ì´ CSVë¥¼ ì—´ë©´:
```
ë°œì†¡ì¼ì‹œ,ìˆ˜ì‹ ì,ì´ë©”ì¼
â†’ ì´ë ‡ê²Œ ê¹¨ì ¸ì„œ ë³´ì¼ ìˆ˜ ìˆìŒ: Ã«Â°Å“Ã¬â€ Â¡Ã¬Â¼Ã¬â€¹Å“,Ã¬Ë†ËœÃ¬â€¹ Ã¬Å¾,Ã¬Â´Ã«Â©"Ã¬Â¼
```

</details>

---

## ğŸ“Œ í•µì‹¬ ì •ë¦¬

| ê°œë… | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|
| **ì¡°ê±´ë¶€ ë Œë”ë§** | ì¡°ê±´ì— ë”°ë¼ ë‹¤ë¥¸ UI í‘œì‹œ | `recipientType === "student" ? ... : ...` |
| **useMemo** | ê³„ì‚° ê²°ê³¼ ê¸°ì–µí•˜ê¸° | `useMemo(() => filter(emails), [deps])` |
| **useCallback** | í•¨ìˆ˜ ê¸°ì–µí•˜ê¸° | `useCallback(() => loadData(), [])` |
| **slice** | ë°°ì—´ ì¼ë¶€ ì¶”ì¶œ | `emails.slice(0, displayCount)` |
| **some** | ì¡°ê±´ ë§Œì¡±í•˜ëŠ” ìš”ì†Œ ìˆëŠ”ì§€ | `groups.some(g => g.id === id)` |
| **filter** | ì¡°ê±´ ë§Œì¡±í•˜ëŠ” ìš”ì†Œë§Œ ì¶”ì¶œ | `emails.filter(e => e.id !== null)` |
| **Promise.all** | ì—¬ëŸ¬ ë¹„ë™ê¸° ì‘ì—… ë™ì‹œ ì‹¤í–‰ | `Promise.all([load1(), load2()])` |
| **Blob** | íŒŒì¼ ë°ì´í„° ê°ì²´ | `new Blob([content], { type: "text/csv" })` |
| **BOM** | í•œê¸€ ì¸ì½”ë”© í‘œì‹œ | `"\uFEFF"` |

---

## ğŸ‰ ë§ˆë¬´ë¦¬

ì˜¤ëŠ˜ ë°°ìš´ ë‚´ìš©:

1. âœ… **GroupTabs**: íƒ­ìœ¼ë¡œ í™”ë©´ ì „í™˜í•˜ê¸°
2. âœ… **BulkEmailSender**: ê·¸ë£¹ ì„ íƒ + í…œí”Œë¦¿ + ì¼ê´„ ë°œì†¡
3. âœ… **EmailHistory**: ë°œì†¡ ì´ë ¥ ì¡°íšŒ + í•„í„°ë§ + CSV ë‚´ë³´ë‚´ê¸°
4. âœ… **ì‹¤ì‹œê°„ ë™ê¸°í™”**: ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ê°€ ê°™ì€ ë°ì´í„°ë¥¼ ê³µìœ í•˜ëŠ” ë°©ë²•
5. âœ… **ì‚­ì œ ê°ì§€**: ì„ íƒí•œ í•­ëª©ì´ ì‚­ì œë˜ë©´ ìë™ìœ¼ë¡œ ì„ íƒ í•´ì œ

ì´ ì„¸ ì»´í¬ë„ŒíŠ¸ê°€ í•¨ê»˜ ë™ì‘í•˜ë©´ì„œ **êµì‚¬ê°€ í•™ìƒ/êµì‚¬ì—ê²Œ ì´ë©”ì¼ì„ ë³´ë‚´ê³  ì´ë ¥ì„ ê´€ë¦¬**í•˜ëŠ” ì™„ì „í•œ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤! ğŸš€
