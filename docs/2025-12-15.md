# 2025년 12월 15일 코드 수정 가이드

## 📚 오늘 배울 내용
1. 그룹 멤버(학생) 수정 기능 추가하기
2. 로그인 후 이동 경로 통일하기

---

## 1. 그룹 멤버(학생) 수정 기능

### 🎯 목표
기존에 저장된 학생 그룹에서 학생을 추가하거나 삭제할 수 있는 기능을 만듭니다.

### 📝 개념 설명

**상태(State)란?**
React에서 화면에 보여지는 데이터를 저장하는 공간입니다. 상태가 바뀌면 화면도 자동으로 바뀝니다.

**편집 모드란?**
"지금 수정 중이에요"라고 알려주는 상태입니다. 편집 모드일 때는 다른 버튼들이 비활성화됩니다.

---

### 💻 코드 작성하기

#### Step 1: 새로운 상태 추가하기

```typescript
// 어떤 그룹의 멤버를 수정 중인지 저장하는 상태
const [editingMembersGroupId, setEditingMembersGroupId] = useState<string | null>(null);

// 수정 중인 그룹의 전체 정보를 저장하는 상태
const [editingMembersGroup, setEditingMembersGroup] = useState<StudentGroup | null>(null);
```

**쉽게 이해하기:**
- `editingMembersGroupId`: 수정 중인 그룹의 ID (고유번호)
- `editingMembersGroup`: 수정 중인 그룹의 모든 정보 (이름, 학생 목록 등)
- `null`은 "아무것도 없음"을 의미합니다

---

#### Step 2: 멤버 수정 시작 함수

```typescript
const handleStartEditMembers = (group: StudentGroup) => {
  // 1. 수정할 그룹의 ID 저장
  setEditingMembersGroupId(group.id);
  
  // 2. 수정할 그룹의 전체 정보 저장
  setEditingMembersGroup(group);
  
  // 3. 현재 그룹에 있는 학생들을 선택된 상태로 만들기
  setSelectedStudents(group.student_ids);
  
  // 4. 불러온 학생 목록 초기화 (혼란 방지)
  setLoadedGroupStudents([]);
};
```

**쉽게 이해하기:**
- 이 함수는 "멤버수정" 버튼을 클릭하면 실행됩니다
- 그룹에 이미 있는 학생들은 자동으로 체크박스가 선택됩니다

---

#### Step 3: 멤버 수정 취소 함수

```typescript
const handleCancelEditMembers = () => {
  // 모든 상태를 초기화
  setEditingMembersGroupId(null);
  setEditingMembersGroup(null);
  setSelectedStudents([]);
};
```

**쉽게 이해하기:**
- "취소" 버튼을 누르면 수정 모드에서 나갑니다
- 선택한 학생들도 모두 해제됩니다

---

#### Step 4: 멤버 수정 저장 함수 (가장 중요!)

```typescript
const handleSaveEditMembers = async () => {
  // 1. 수정 중인 그룹이 없으면 함수 종료
  if (!editingMembersGroupId) return;
  
  // 2. 최소 1명의 학생이 선택되어야 함
  if (selectedStudents.length === 0) {
    toast.error("최소 1명의 학생을 선택해주세요.");
    return;
  }

  try {
    // 3. 데이터베이스에 변경사항 저장
    const { error } = await supabase
      .from('student_groups')           // student_groups 테이블에서
      .update({ student_ids: selectedStudents })  // student_ids를 업데이트
      .eq('id', editingMembersGroupId); // 해당 그룹 ID와 일치하는 행만

    if (error) throw error;

    // 4. 화면에 보이는 그룹 목록도 업데이트
    setGroups(groups.map(group => 
      group.id === editingMembersGroupId 
        ? { ...group, student_ids: selectedStudents }  // 수정된 그룹
        : group  // 다른 그룹은 그대로
    ));
    
    // 5. 성공 메시지 표시
    toast.success(`그룹 멤버가 수정되었습니다. (${selectedStudents.length}명)`);
    
    // 6. 편집 모드 종료
    handleCancelEditMembers();
  } catch (error) {
    toast.error("멤버 수정에 실패했습니다.");
  }
};
```

**쉽게 이해하기:**

1. **Supabase 업데이트 문법:**
```typescript
supabase
  .from('테이블이름')      // 어떤 테이블?
  .update({ 컬럼: 값 })    // 무엇을 바꿀까?
  .eq('id', 그룹ID)        // 어떤 행을?
```

2. **map() 함수로 배열 수정하기:**
```typescript
// 배열의 각 항목을 하나씩 확인하면서 새 배열을 만듭니다
groups.map(group => 
  group.id === 수정할ID 
    ? { ...group, student_ids: 새로운학생목록 }  // 조건이 맞으면 수정
    : group                                       // 아니면 그대로
)
```

3. **스프레드 연산자 `...`:**
```typescript
{ ...group, student_ids: 새값 }
// group의 모든 속성을 복사하고, student_ids만 새 값으로 바꿈
```

---

#### Step 5: 화면(UI) 구성하기

**멤버 수정 중일 때 보여주는 안내 카드:**

```tsx
{editingMembersGroup && (
  <Card className="p-3 border-orange-500 bg-orange-50">
    <div className="flex items-center justify-between">
      <div className="flex items-center gap-2 text-sm font-medium text-orange-700">
        <UserPlus size={16} />
        <span>"{editingMembersGroup.group_name}" 그룹 멤버 수정 중</span>
      </div>
      <div className="flex gap-2">
        <Button size="sm" variant="outline" onClick={handleCancelEditMembers}>
          취소
        </Button>
        <Button size="sm" onClick={handleSaveEditMembers}>
          저장 ({selectedStudents.length}명)
        </Button>
      </div>
    </div>
  </Card>
)}
```

**쉽게 이해하기:**
- `{조건 && <컴포넌트/>}`: 조건이 참일 때만 컴포넌트를 보여줍니다
- `border-orange-500`: 주황색 테두리로 "수정 중"임을 강조합니다

---

**멤버수정 버튼 추가하기:**

```tsx
<Button
  size="sm"
  variant="outline"
  onClick={() => handleStartEditMembers(group)}
  disabled={editingGroupId !== null || editingMembersGroupId !== null}
  className="text-orange-600 border-orange-600 hover:bg-orange-50"
>
  <UserPlus size={12} className="mr-1" />
  멤버수정
</Button>
```

**쉽게 이해하기:**
- `disabled={조건}`: 조건이 참이면 버튼을 클릭할 수 없게 만듭니다
- 다른 그룹을 수정 중일 때는 비활성화됩니다

---

## 2. 로그인 후 이동 경로 통일하기

### 🎯 목표
관리자 권한이 있든 없든, 모든 교사는 로그인하면 교사 대시보드로 이동합니다.

### 📝 변경 전 코드

```typescript
// 관리자면 관리자 대시보드로, 아니면 교사 대시보드로
if (user.isAdmin) {
  navigate("/admin/dashboard");
} else {
  navigate("/teacher/dashboard");
}
```

### ✅ 변경 후 코드

```typescript
// 교사는 항상 교사 대시보드로 이동 (관리자 권한 여부 무관)
navigate("/teacher/dashboard");
```

**쉽게 이해하기:**
- 조건문 `if-else`를 삭제하고 하나의 경로만 남겼습니다
- 관리자 교사도 교사 대시보드를 먼저 보고, 필요하면 관리자 대시보드 버튼을 클릭합니다

---

## 🧪 실습 과제

### 과제 1: 코드 이해하기
다음 코드가 무엇을 하는지 설명해보세요:

```typescript
setGroups(groups.map(group => 
  group.id === editingMembersGroupId 
    ? { ...group, student_ids: selectedStudents }
    : group
));
```

<details>
<summary>정답 보기</summary>

1. `groups` 배열의 모든 그룹을 하나씩 확인합니다
2. 그룹의 ID가 수정 중인 그룹 ID와 같으면:
   - 그 그룹의 모든 정보를 복사하고 (`...group`)
   - `student_ids`만 새로운 학생 목록으로 바꿉니다
3. ID가 다르면 그 그룹은 그대로 유지합니다
4. 새로 만들어진 배열을 `setGroups`로 저장합니다

</details>

---

### 과제 2: Supabase 쿼리 작성하기
"merits" 테이블에서 `score`를 10으로 바꾸는 코드를 작성해보세요.
조건: `id`가 "abc123"인 행만 수정

<details>
<summary>정답 보기</summary>

```typescript
const { error } = await supabase
  .from('merits')
  .update({ score: 10 })
  .eq('id', 'abc123');
```

</details>

---

### 과제 3: 조건부 렌더링 이해하기
다음 코드에서 화면에 "안녕하세요"가 보이려면 어떤 조건이 필요할까요?

```tsx
{isLoggedIn && <p>안녕하세요</p>}
```

<details>
<summary>정답 보기</summary>

`isLoggedIn`이 `true`여야 합니다.
`&&` 연산자는 왼쪽이 참(true)일 때만 오른쪽을 보여줍니다.

</details>

---

## 📌 오늘 배운 핵심 개념

| 개념 | 설명 | 예시 |
|------|------|------|
| 상태(State) | 화면에 보여지는 데이터를 저장 | `useState()` |
| 편집 모드 | 수정 중임을 표시하는 상태 | `editingMembersGroupId` |
| Supabase update | 데이터베이스 수정 | `.update({ 컬럼: 값 })` |
| map() | 배열의 각 항목을 변환 | `array.map(item => ...)` |
| 스프레드 연산자 | 객체/배열 복사 | `{ ...object }` |
| 조건부 렌더링 | 조건에 따라 화면 표시 | `{조건 && <컴포넌트/>}` |

---

## 🔗 다음 단계
- 그룹 복사 기능 만들어보기
- 그룹 내 학생 순서 변경 기능 추가하기
- 여러 그룹 한 번에 선택해서 발송하기
